trigger: none
pr:
  - main
  - release/*

extends:
  template: /eng/pipelines/templates/1es-redirect.yml
  parameters:
    variables:
      - template: /eng/pipelines/templates/variables/globals.yml@self
    stages:
      - stage: Build_And_Test
        jobs:
          - job: Build_And_Test_Linux
            variables:
              TYPESPEC_VS_CI_BUILD: true # Enable official Visual Studio extension build
              TYPESPEC_SKIP_DOCUSAURUS_BUILD: true # Disable docusaurus build

            strategy:
              matrix:
                "Node 18.x":
                  nodeVersion: "18.x"
                "Node 20.x":
                  nodeVersion: "20.x"

            pool:
              name: $(LINUXPOOL)
              image: $(LINUXVMIMAGE)
              os: linux

            steps:
              - template: /eng/pipelines/jobs/build-and-test.yml@self
                parameters:
                  nodeVersion: $(nodeVersion)
                  dotnetVersion: 8.0.x
                  osName: linux

              - template: /eng/pipelines/templates/swagger-checks.yml@self
                parameters:
                  nodeVersion: $(nodeVersion)

          - job: Build_And_Test_Windows
            variables:
              TYPESPEC_VS_CI_BUILD: true # Enable official Visual Studio extension build
              TYPESPEC_SKIP_DOCUSAURUS_BUILD: true # Disable docusaurus build

            strategy:
              matrix:
                "Node 18.x":
                  nodeVersion: "18.x"
                "Node 20.x":
                  nodeVersion: "20.x"

            pool:
              name: $(WINDOWSPOOL)
              image: $(WINDOWSVMIMAGE)
              os: windows

            steps:
              - template: /eng/pipelines/jobs/build-and-test.yml@self
                parameters:
                  nodeVersion: $(nodeVersion)
                  dotnetVersion: 8.0.x
                  osName: windows

              - template: /eng/pipelines/templates/swagger-checks.yml@self
                parameters:
                  nodeVersion: $(nodeVersion)

          - template: /eng/pipelines/jobs/e2e-job.yml@self
          - template: /eng/pipelines/jobs/publish-artifacts.yml@self
